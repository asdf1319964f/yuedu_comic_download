# 漫画批量下载器 使用说明书

---

## 目录

1. [简介](#简介)
2. [环境要求](#环境要求)
3. [快速启动](#快速启动)
4. [功能说明](#功能说明)
5. [任务文件格式说明](#任务文件格式说明)
6. [参数说明](#参数说明)
7. [使用流程](#使用流程)
8. [常见问题与注意事项](#常见问题与注意事项)
9. [进阶功能](#进阶功能)
10. [更新与维护](#更新与维护)

---

## 简介

本程序是一个基于Web界面的**漫画批量下载器**，支持上传任务文件（.txt/.json），自动批量下载图片并打包为ZIP，支持多线程、代理、AES解密、断点续传、暂停/恢复、rclone网盘上传等功能。适合批量备份、归档漫画图片。

---

## 环境要求

- Python 3.7 及以上
- pip 包：`flask`, `requests`, `pycryptodome`
- rclone（可选，需上传到网盘时）

**安装依赖：**
```bash
pip install flask requests pycryptodome
```

---

## 快速启动

1. **下载源码**，解压到本地。
2. **安装依赖**（见上）。
3. **运行程序：**
   ```bash
   python app.py
   ```
4. **浏览器访问：**
   ```
   http://127.0.0.1:5000/
   ```
   按照页面提示操作。

---

## 功能说明

- 支持上传 `.txt` 或 `.json` 任务文件，自动识别格式。
- 支持自定义 Cookie、代理、线程数。
- 支持 AES-CBC 解密（部分加密图片站点）。
- 支持下载进度实时显示、日志查看。
- 支持任务暂停/恢复。
- 支持下载完成后自动打包为 ZIP。
- 支持打包后自动删除原文件夹。
- 支持 rclone 一键上传 ZIP 包到网盘。
- 支持 AES 密钥本地保存与快速切换。

---

## 任务文件格式说明

### 1. TXT格式

- 每一行为图片链接或章节名。
- 支持带 Referer/Origin 的图片链接。
- 支持章节分组。

**示例：**
```
作者: 某某
📌当前源站：⓪https://example.com

第1章
https://img1.example.com/1.jpg
https://img1.example.com/2.jpg

第2章
https://img2.example.com/3.jpg,{"headers":{"Referer":"https://example.com"}}
```

### 2. JSON格式

- 结构化，适合程序生成。
- 必须包含 `title`, `author`, `chapters` 字段。

**示例：**
```json
{
  "title": "漫画名",
  "author": "作者名",
  "referer": "https://example.com",
  "chapters": [
    {
      "title": "第1章",
      "images": [
        {"url": "https://img1.example.com/1.jpg"},
        {"url": "https://img1.example.com/2.jpg"}
      ]
    }
  ]
}
```

---

## 参数说明

| 参数                | 说明                                                         |
|---------------------|--------------------------------------------------------------|
| 任务文件            | 支持 .txt/.json，详见上文                                    |
| Cookie              | 某些站点需登录，填写浏览器抓包的 Cookie                      |
| 代理列表            | 每行一个代理，支持 socks5/http/https                         |
| 下载线程数          | 建议4-8，过高可能被封IP或影响性能                            |
| 下载后自动打包      | 勾选后下载完成自动生成ZIP包                                  |
| 打包后删除原文件夹  | 勾选后ZIP包生成后删除原图片文件夹                            |
| AES密钥/IV          | 部分加密站点需填写，支持16字节字符串或32位hex                |
| 密钥名称            | 仅用于本地保存密钥配置时备注                                 |

---

## 使用流程

1. **准备任务文件**（.txt/.json），可用爬虫/脚本/手工整理。
2. **打开网页**，上传任务文件。
3. **如需登录，填写Cookie**（浏览器F12抓包获取）。
4. **如需代理，填写代理列表**（如`socks5://127.0.0.1:1080`）。
5. **如需解密，填写AES密钥和IV**（部分站点需）。
6. **设置线程数、打包选项**。
7. **点击“开始下载”**，等待进度条完成。
8. **下载完成后，点击“下载ZIP包”**。
9. **如需上传网盘，填写rclone远程路径，点击上传**。

---

## 常见问题与注意事项

- **Cookie获取**：浏览器登录目标站点，F12-网络-请求头，复制`Cookie`字段。
- **代理格式**：支持`socks5://ip:port`、`http://ip:port`等。
- **AES密钥/IV**：部分站点图片加密，需站点专用密钥，格式支持16字节字符串或32位hex。
- **任务暂停/恢复**：下载过程中可随时暂停/恢复，支持断点续传。
- **rclone上传**：需本地已配置好rclone，命令行可用。
- **大文件/多线程**：线程数过高可能导致IP被封或服务器卡死，建议4-8。
- **自动清理**：程序会自动清理7天前的历史文件和任务数据。

---

## 进阶功能

### 1. AES密钥本地保存

- 可保存常用密钥，快速切换。
- 密钥仅保存在本地浏览器，不上传服务器。

### 2. rclone一键上传

- 下载完成后，填写rclone远程路径（如`gdrive:漫画备份/`），一键上传ZIP包到网盘。
- 上传日志实时显示。

### 3. 任务管理

- 支持多任务并发，任务状态实时查询。
- 支持任务中断恢复（如服务器重启，任务会标记为“中断”）。

---

## 更新与维护

- **依赖升级**：如遇到依赖问题，尝试升级`pip install --upgrade flask requests pycryptodome`。
- **rclone配置**：如需上传网盘，需提前配置好rclone。
- **反馈与建议**：如有bug或建议，请联系开发者或在项目主页反馈。

---

## 联系方式

- 作者：未知作者
- 项目主页/反馈：请联系源码发布者

---

## 附录：常见错误排查

- **下载失败/403**：检查Cookie、Referer、代理、AES密钥是否正确。
- **图片解密失败**：确认密钥/IV格式及内容，部分站点密钥需特殊获取。
- **rclone上传失败**：检查rclone配置、远程路径、网络连通性。
- **程序报错**：查看网页日志框和命令行输出，按提示排查。

---

## 祝您使用愉快！

---

如需进一步定制或二次开发，请阅读源码注释，或联系开发者。
